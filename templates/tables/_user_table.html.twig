<div class="card-body px-0 pb-2">
  <div class="table-responsive p-0">
    <table class="table align-items-center mb-0">
      <thead>
        <tr>
          <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Nom</th>
          <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">Prénom</th>
          <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">Email</th>
          <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">Téléphone</th>
          {% if role == 'Artisan' or role == 'Constructeur' %}
            <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">Spécialité</th>
            <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">Salaire / h</th>
          {% endif %}
          <th class="text-uppercase text-secondary text-xxs font-weight-bolder text-center opacity-7">Statut</th>
          <th class="text-uppercase text-secondary text-xxs font-weight-bolder text-center opacity-7">Actions</th>
        </tr>
      </thead>

      <tbody>
  {% for user in users %}
    <tr 
      data-bs-toggle="modal" 
      data-bs-target="#viewUserModal{{ user.id }}" 
      style="cursor: pointer;"
    >
      <td>
        <div class="d-flex px-2 py-1">
          <div>
            <img src="../assets/img/default-avatar.png" class="avatar avatar-xs me-2 border-radius-lg" alt="user">
          </div>
          <div class="d-flex flex-column justify-content-center">
            <h6 class="mb-0 text-xs">{{ user.nom }}</h6>
          </div>
        </div>
      </td>
      <td><p class="text-xs font-weight-bold mb-0">{{ user.prenom }}</p></td>
      <td><p class="text-xs mb-0">{{ user.email }}</p></td>
      <td><p class="text-xs mb-0">{{ user.telephone }}</p></td>

      {% if role == 'Artisan' %}
        {% set artisan = user.artisan ?? null %}
        <td><p class="text-xs mb-0">{{ artisan is not null ? artisan.specialite : 'N/A' }}</p></td>
        <td><p class="text-xs mb-0">{{ artisan is not null ? artisan.salaireHeure ~ ' €' : 'N/A' }}</p></td>
      {% elseif role == 'Constructeur' %}
        {% set constructeur = user.constructeur ?? null %}
        <td><p class="text-xs mb-0">{{ constructeur is not null ? constructeur.specialite : 'N/A' }}</p></td>
        <td><p class="text-xs mb-0">{{ constructeur is not null ? constructeur.salaireHeure ~ ' €' : 'N/A' }}</p></td>
      {% endif %}

      <td class="align-middle text-center text-sm">
        <span class="badge badge-sm {{ user.statut == 'Actif' ? 'bg-gradient-success' : 'bg-gradient-secondary' }}">
          {{ user.statut }}
        </span>
      </td>

      <td class="align-middle text-center">
        <a href="{{ path('utilisateur_delete', { id: user.id }) }}"
           onclick="event.stopPropagation(); return confirm('Êtes-vous sûr de vouloir supprimer cet utilisateur ?');"
           class="text-danger font-weight-bold text-xs ms-2" 
           title="Supprimer">
          <i class="material-icons text-danger">delete</i>
        </a>
      </td>
    </tr>

    <!-- Modal View -->
    <div class="modal fade" id="viewUserModal{{ user.id }}" tabindex="-1" aria-labelledby="viewUserLabel{{ user.id }}" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
          <div class="modal-header bg-gradient-primary text-white">
            <h5 class="modal-title" id="viewUserLabel{{ user.id }}">Détails de {{ user.nom }} {{ user.prenom }}</h5>
            <button type="button" class="btn-close text-white" data-bs-dismiss="modal" aria-label="Fermer"></button>
          </div>
          <div class="modal-body">
            <ul class="list-group">
              <li class="list-group-item"><strong>Email:</strong> {{ user.email }}</li>
              <li class="list-group-item"><strong>Téléphone:</strong> {{ user.telephone }}</li>
              {% if role == 'Artisan' %}
                <li class="list-group-item"><strong>Spécialité:</strong> {{ artisan is not null ? artisan.specialite : 'N/A' }}</li>
                <li class="list-group-item"><strong>Salaire / h:</strong> {{ artisan is not null ? artisan.salaireHeure ~ ' €' : 'N/A' }}</li>
              {% elseif role == 'Constructeur' %}
                <li class="list-group-item"><strong>Spécialité:</strong> {{ constructeur is not null ? constructeur.specialite : 'N/A' }}</li>
                <li class="list-group-item"><strong>Salaire / h:</strong> {{ constructeur is not null ? constructeur.salaireHeure ~ ' €' : 'N/A' }}</li>
              {% endif %}
              <li class="list-group-item"><strong>Statut:</strong> 
                <span class="badge {{ user.statut == 'Actif' ? 'bg-success' : 'bg-secondary' }}">{{ user.statut }}</span>
              </li>
            </ul>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
          </div>
        </div>
      </div>
    </div>
  {% else %}
    <tr>
      <td colspan="8" class="text-center py-4">
        <span class="text-secondary">Aucun utilisateur trouvé pour ce rôle.</span>
      </td>
    </tr>
  {% endfor %}
</tbody>

    </table>
  </div>
</div>
